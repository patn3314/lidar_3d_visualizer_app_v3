# LiDAR 3D Visualizer & Simulator - Windows セットアップガイド

これは、ブラウザ上でLiDAR（Velodyne VLP-16 および SICK TiM571）の赤外線（レーザ）照射範囲を3Dで可視化・シミュレーションできる静的Webアプリケーションです。

## Windows環境でのセットアップ手順

### 前提条件

1. **Node.jsのインストール**
   - [Node.js公式サイト](https://nodejs.org/ja/)から最新のLTS版（推奨版）をダウンロードします
   - ダウンロードしたインストーラ（.msiファイル）を実行します
   - インストールウィザードの指示に従って進めます（基本的にはデフォルト設定でOK）
   - 「npm package manager」が含まれていることを確認してください
   - インストール完了後、コマンドプロンプトを開き、以下のコマンドでインストールを確認します：
     ```
     node --version
     npm --version
     ```

2. **プロジェクトファイルの展開**
   - 提供されたZIPファイル（`lidar_3d_visualizer_app.zip`）をエクスプローラで右クリックし、「すべて展開」を選択します
   - 展開先を選択し、「展開」ボタンをクリックします
   - 日本語を含むパスは避けることをお勧めします（例：`C:\Projects\lidar-visualizer`）

### 開発環境での実行（ソースコードから実行）

1. **コマンドプロンプトを開く**
   - Windowsキー + Rを押して「ファイル名を指定して実行」を開きます
   - `cmd`と入力して実行します

2. **プロジェクトディレクトリに移動**
   - 以下のコマンドでプロジェクトディレクトリに移動します（パスは実際の展開先に合わせて変更してください）：
     ```
     cd C:\path\to\project-root
     ```
   - Windowsではパス区切りにバックスラッシュ（`\`）を使用します
   - パスに空白が含まれる場合は引用符で囲みます：`cd "C:\My Projects\lidar-visualizer"`

3. **依存関係のインストール**
   - 以下のコマンドを実行して必要なパッケージをインストールします：
     ```
     npm install
     ```
   - インストールには数分かかる場合があります

4. **開発サーバーの起動**
   - インストールが完了したら、以下のコマンドで開発サーバーを起動します：
     ```
     npm run dev
     ```
   - 自動的にデフォルトブラウザでアプリケーションが開きます
   - 開かない場合は、表示されるURLをブラウザにコピー＆ペーストしてください（通常は `http://localhost:5173/`）

### ビルド済みアプリケーションの実行

ソースコードを編集せずに実行するだけであれば、以下の手順で簡単に実行できます：

1. ZIPファイルを展開した後、`dist`フォルダを開きます
2. `index.html`ファイルをダブルクリックします
3. ブラウザでアプリケーションが開きます

### 自分でビルドする場合

アプリケーションを自分でビルドする場合は、以下の手順に従います：

1. プロジェクトディレクトリで以下のコマンドを実行します：
   ```
   npm run build
   ```

2. ビルドが完了すると、`dist`フォルダに成果物が生成されます
3. `dist/index.html`をブラウザで開くことで、ビルドしたアプリケーションを実行できます

### トラブルシューティング

1. **「npm は内部コマンドまたは外部コマンド、操作可能なプログラムまたはバッチ ファイルとして認識されていません。」というエラーが表示される場合**
   - Node.jsが正しくインストールされていない可能性があります
   - コマンドプロンプトを再起動してみてください
   - それでも解決しない場合は、Node.jsを再インストールしてください

2. **「EACCES（権限エラー）」が表示される場合**
   - コマンドプロンプトを管理者として実行してみてください
   - Windowsキー + Xを押し、「コマンドプロンプト (管理者)」を選択します

3. **ブラウザでアプリケーションが正しく表示されない場合**
   - 最新のChrome、Edge、またはFirefoxを使用していることを確認してください
   - ブラウザのキャッシュをクリアしてみてください（Ctrl + F5）

## 主要機能

1.  **3D空間生成**
    *   数値入力でX,Y,Zの範囲 (m) を指定しワールドを初期化します。各入力欄には単位（メートル）が明示されています。
    *   y = 0 の床面へ平面図画像を四隅座標で貼り付けます（テクスチャ繰返し無し）。現状の実装では、テクスチャは平面全体に引き伸ばして表示されます。

2.  **障害物モデル**
    *   任意座標/寸法で直方体（axis-aligned box）を追加・編集・削除できます。全ての入力欄には単位（メートル）が明示されています。
    *   箱はセンサビームの当たり判定対象となります。

3.  **センサ仕様テンプレート（外部設定ファイル読込）**
    *   `sensors.json` に各センサの仕様を定義し、起動時に自動ロードします。
    *   新しい機種の追加は、このファイルに追記するだけで反映されます。

4.  **センサ配置UI**
    *   数値入力で `(x, y, z)` と `(roll, pitch, yaw)` を指定してセンサを配置します。各入力欄には単位（メートルや度）が明示されています。
    *   複数台のセンサを配置可能で、個別に表示/非表示を切り替えられます。

5.  **照射ボリューム可視化**
    *   各ビームを半透明（透明度75%）のコーン（cone）で描画します。
    *   射線は障害物または床にヒットするとそこで停止します。
    *   描画更新はリアルタイムで行われます（Three.js レイキャストを利用）。

6.  **データエクスポート／インポート**
    *   現在のシーン（空間設定、障害物、センサ配置）をJSON形式で保存・読み込みできます。

## 技術仕様

*   **フレームワーク/ライブラリ:** Three.js, TypeScript
*   **ビルドツール:** Vite
*   **動作環境:** 最新のChrome / Edge / Firefox (デスクトップ版)
*   **UI表示言語:** 日本語

## プロジェクト構造

```
/project-root
├─ public/                  # 静的アセット
│  ├─ index.html            # メインHTMLファイル
│  ├─ assets/               # 3Dモデル等のアセット
│  │  ├─ vlp16.glb
│  │  └─ tim571.glb
│  └─ sensors.json          # センサ定義ファイル (publicに配置してfetch)
├─ src/                     # ソースコード
│  ├─ main.ts               # アプリケーションエントリーポイント
│  ├─ scene/                # 3Dシーン関連モジュール
│  │  ├─ world.ts            # ワールド（空間、床）管理
│  │  ├─ sensor.ts           # センサ配置・管理
│  │  ├─ beams.ts            # ビーム描画・衝突判定
│  │  └─ obstacle.ts         # 障害物管理
│  └─ ui/                   # UI関連モジュール
│     ├─ panel.ts            # 設定パネルUI管理
│     └─ loaders.ts          # JSONのインポート/エクスポート処理
├─ style.css                # スタイルシート
├─ vite.config.ts           # Vite設定ファイル
├─ tsconfig.json            # TypeScript設定ファイル
├─ package.json             # プロジェクト依存関係
└─ README.md                # このファイル
```

## ライセンス

このプロジェクトで使用している主要なライブラリのライセンスは以下の通りです。

*   **Three.js:** MIT License
*   **Vite:** MIT License

本プロジェクトのコード自体は、特に指定がない限り、ユーザー様の指示に基づき生成されたものであり、特定のライセンスを主張するものではありません。ただし、同梱されている `vlp16.glb` および `tim571.glb` はダミーファイルであり、実際の製品モデルの著作権は各メーカーに帰属します。実際のモデルを使用する際は、各メーカーの利用規約に従ってください。

## 留意点

*   センサモデル（`.glb`ファイル）は、要件に基づき簡易的なダミーファイルとして配置しています。実際の詳細なモデルに置き換えることで、より現実に近いシミュレーションが可能です。
*   床面へのテクスチャ貼り付けは、現状では指定された画像全体を床面全体に引き伸ばして表示する実装となっています。四隅座標を指定しての精密なマッピングは、より高度なUV操作やシェーダー処理が必要となるため、現時点では実装されていません。
*   コメントは主要なロジック部分に付与していますが、すべての行に詳細なコメントがあるわけではありません。
*   全ての入力欄には、どの値を入力すべきか、単位は何かを示すプレースホルダーが表示されます。
