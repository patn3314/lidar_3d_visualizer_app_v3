# LiDAR 3D Visualizer & Simulator

これは、ブラウザ上でLiDAR（Velodyne VLP-16 および SICK TiM571）の赤外線（レーザ）照射範囲を3Dで可視化・シミュレーションできる静的Webアプリケーションです。

## 主要機能

1.  **3D空間生成**
    *   数値入力でX,Y,Zの範囲 (m) を指定しワールドを初期化します。各入力欄には単位（メートル）が明示されています。
    *   y = 0 の床面へ平面図画像を四隅座標で貼り付けます（テクスチャ繰返し無し）。現状の実装では、テクスチャは平面全体に引き伸ばして表示されます。

2.  **障害物モデル**
    *   任意座標/寸法で直方体（axis-aligned box）を追加・編集・削除できます。全ての入力欄には単位（メートル）が明示されています。
    *   箱はセンサビームの当たり判定対象となります。

3.  **センサ仕様テンプレート（外部設定ファイル読込）**
    *   `sensors.json` に各センサの仕様を定義し、起動時に自動ロードします。
    *   新しい機種の追加は、このファイルに追記するだけで反映されます。

4.  **センサ配置UI**
    *   数値入力で `(x, y, z)` と `(roll, pitch, yaw)` を指定してセンサを配置します。各入力欄には単位（メートルや度）が明示されています。
    *   複数台のセンサを配置可能で、個別に表示/非表示を切り替えられます。

5.  **照射ボリューム可視化**
    *   各ビームを半透明（透明度75%）のコーン（cone）で描画します。
    *   射線は障害物または床にヒットするとそこで停止します。
    *   描画更新はリアルタイムで行われます（Three.js レイキャストを利用）。

6.  **データエクスポート／インポート**
    *   現在のシーン（空間設定、障害物、センサ配置）をJSON形式で保存・読み込みできます。

## 技術仕様

*   **フレームワーク/ライブラリ:** Three.js, TypeScript
*   **ビルドツール:** Vite
*   **動作環境:** 最新のChrome / Edge / Firefox (デスクトップ版)
*   **UI表示言語:** 日本語

## プロジェクト構造

```
/project-root
├─ public/                  # 静的アセット
│  ├─ index.html            # メインHTMLファイル
│  ├─ assets/               # 3Dモデル等のアセット
│  │  ├─ vlp16.glb
│  │  └─ tim571.glb
│  └─ sensors.json          # センサ定義ファイル (publicに配置してfetch)
├─ src/                     # ソースコード
│  ├─ main.ts               # アプリケーションエントリーポイント
│  ├─ scene/                # 3Dシーン関連モジュール
│  │  ├─ world.ts            # ワールド（空間、床）管理
│  │  ├─ sensor.ts           # センサ配置・管理
│  │  ├─ beams.ts            # ビーム描画・衝突判定
│  │  └─ obstacle.ts         # 障害物管理
│  └─ ui/                   # UI関連モジュール
│     ├─ panel.ts            # 設定パネルUI管理
│     └─ loaders.ts          # JSONのインポート/エクスポート処理
├─ style.css                # スタイルシート
├─ vite.config.ts           # Vite設定ファイル
├─ tsconfig.json            # TypeScript設定ファイル
├─ package.json             # プロジェクト依存関係
└─ README.md                # このファイル
```

## セットアップと実行

1.  Node.jsとnpm (またはpnpm/yarn) がインストールされていることを確認します。
2.  プロジェクトルートで依存関係をインストールします:
    ```bash
    npm install
    # または
    # pnpm install
    # yarn install
    ```
3.  開発サーバーを起動します:
    ```bash
    npm run dev
    # または
    # pnpm dev
    # yarn dev
    ```
    これにより、ブラウザでアプリケーションが開きます。

4.  ビルドする場合:
    ```bash
    npm run build
    # または
    # pnpm build
    # yarn build
    ```
    ビルド成果物は `dist/` ディレクトリに生成されます。

## ライセンス

このプロジェクトで使用している主要なライブラリのライセンスは以下の通りです。

*   **Three.js:** MIT License
*   **Vite:** MIT License

本プロジェクトのコード自体は、特に指定がない限り、ユーザー様の指示に基づき生成されたものであり、特定のライセンスを主張するものではありません。ただし、同梱されている `vlp16.glb` および `tim571.glb` はダミーファイルであり、実際の製品モデルの著作権は各メーカーに帰属します。実際のモデルを使用する際は、各メーカーの利用規約に従ってください。

## 留意点

*   センサモデル（`.glb`ファイル）は、要件に基づき簡易的なダミーファイルとして配置しています。実際の詳細なモデルに置き換えることで、より現実に近いシミュレーションが可能です。
*   床面へのテクスチャ貼り付けは、現状では指定された画像全体を床面全体に引き伸ばして表示する実装となっています。四隅座標を指定しての精密なマッピングは、より高度なUV操作やシェーダー処理が必要となるため、現時点では実装されていません。
*   コメントは主要なロジック部分に付与していますが、すべての行に詳細なコメントがあるわけではありません。
*   全ての入力欄には、どの値を入力すべきか、単位は何かを示すプレースホルダーが表示されます。
